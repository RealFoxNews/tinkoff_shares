'use strict';const _0x37eca4=_0x17bf;(function(_0x6cfb9c,_0x2134ad){const _0x3780b8=_0x17bf,_0x12d370=_0x6cfb9c();while(!![]){try{const _0x1706a6=-parseInt(_0x3780b8(0x15b))/0x1+-parseInt(_0x3780b8(0x141))/0x2+-parseInt(_0x3780b8(0x14d))/0x3*(parseInt(_0x3780b8(0x13f))/0x4)+parseInt(_0x3780b8(0x15a))/0x5+parseInt(_0x3780b8(0x15d))/0x6*(parseInt(_0x3780b8(0x134))/0x7)+-parseInt(_0x3780b8(0x158))/0x8+-parseInt(_0x3780b8(0x165))/0x9*(-parseInt(_0x3780b8(0x13e))/0xa);if(_0x1706a6===_0x2134ad)break;else _0x12d370['push'](_0x12d370['shift']());}catch(_0x5a8945){_0x12d370['push'](_0x12d370['shift']());}}}(_0x5093,0x6e38b));function _0x5093(){const _0x2141fd=['market','tinkoff-invest-api/cjs/generated/instruments','tap','stream\x20error','202326HnxQSA','DropFutures','log','stream\x20closed,\x20reason:','buy','resolve','INSTRUMENT_STATUS_BASE','error','options','done','api','4169432gAcZHz','next','3063365zFnEFz','792814LUOHEW','buyTheDrop','78QLvtAt','tinkoff-invest-api','return','asyncIterator','moexDiffFuture','instruments','nearestHighIncrementValue','units','9ePzarl','length','defineProperty','candles','Symbol.asyncIterator\x20is\x20not\x20defined.','push','InstrumentStatus','value','function','processOnCandle','__asyncValues','moexDiffFutureBuy','then','filter','startFuturesDrop','234997XwSosY','nano','all','getPrice','tinkoff-invest-api/cjs/generated/marketdata','rxjs','halt','slice','../utils/nearest-increment-value','throw','22586230CKcDkr','44JYkLbJ','SubscriptionInterval','1600794XdlcOQ','figi','minPriceIncrement','Subject','stop','pipe','close','futures'];_0x5093=function(){return _0x2141fd;};return _0x5093();}var __asyncValues=this&&this[_0x37eca4(0x12f)]||function(_0x5e072f){const _0xb08d5b=_0x37eca4;if(!Symbol[_0xb08d5b(0x160)])throw new TypeError(_0xb08d5b(0x169));var _0x293d4a=_0x5e072f[Symbol[_0xb08d5b(0x160)]],_0x26e0a1;return _0x293d4a?_0x293d4a['call'](_0x5e072f):(_0x5e072f=typeof __values===_0xb08d5b(0x16d)?__values(_0x5e072f):_0x5e072f[Symbol['iterator']](),_0x26e0a1={},_0x354d0a(_0xb08d5b(0x159)),_0x354d0a(_0xb08d5b(0x13d)),_0x354d0a(_0xb08d5b(0x15f)),_0x26e0a1[Symbol['asyncIterator']]=function(){return this;},_0x26e0a1);function _0x354d0a(_0x1e7606){_0x26e0a1[_0x1e7606]=_0x5e072f[_0x1e7606]&&function(_0xc25b1f){return new Promise(function(_0x47eaa4,_0x4bb114){const _0x40bd6c=_0x17bf;_0xc25b1f=_0x5e072f[_0x1e7606](_0xc25b1f),_0xfbc30(_0x47eaa4,_0x4bb114,_0xc25b1f[_0x40bd6c(0x156)],_0xc25b1f[_0x40bd6c(0x16c)]);});};}function _0xfbc30(_0xb2b5c3,_0x59877d,_0x1791e4,_0x499bbf){const _0x43cdf4=_0xb08d5b;Promise[_0x43cdf4(0x152)](_0x499bbf)[_0x43cdf4(0x131)](function(_0x17242f){_0xb2b5c3({'value':_0x17242f,'done':_0x1791e4});},_0x59877d);}};function _0x17bf(_0x4e4388,_0x46d046){const _0x509326=_0x5093();return _0x17bf=function(_0x17bf71,_0x273903){_0x17bf71=_0x17bf71-0x12f;let _0x174086=_0x509326[_0x17bf71];return _0x174086;},_0x17bf(_0x4e4388,_0x46d046);}Object[_0x37eca4(0x167)](exports,'__esModule',{'value':!![]}),exports['DropFutures']=void 0x0;const rxjs_1=require(_0x37eca4(0x139)),tinkoff_invest_api_1=require(_0x37eca4(0x15e)),instruments_1=require(_0x37eca4(0x14a)),marketdata_1=require(_0x37eca4(0x138)),nearest_increment_value_1=require(_0x37eca4(0x13c)),CHANK_SIZE=0x12c;class DropFutures{constructor(_0x1e7b38,_0x10f838){const _0x587974=_0x37eca4;this['api']=_0x1e7b38,this[_0x587974(0x155)]=_0x10f838,this[_0x587974(0x15c)]=new rxjs_1[(_0x587974(0x144))](),this['unsubscribes']=[],this[_0x587974(0x151)]=this[_0x587974(0x15c)][_0x587974(0x146)]((0x0,rxjs_1[_0x587974(0x132)])(()=>!this['halt']),(0x0,rxjs_1[_0x587974(0x14b)])(()=>{const _0x30c7b4=_0x587974;!this[_0x30c7b4(0x13a)]&&(this[_0x30c7b4(0x13a)]=!![],setTimeout(()=>this['halt']=![],this[_0x30c7b4(0x155)]['haltTimeout']));}));}async[_0x37eca4(0x133)](){const _0x137772=_0x37eca4;var _0x4edebc,_0x11b3e1,_0x9ac946,_0x22e069;const _0x245fd4=await this['api'][_0x137772(0x162)][_0x137772(0x148)]({'instrumentStatus':instruments_1[_0x137772(0x16b)][_0x137772(0x153)]}),_0x37beeb=[];for(let _0x2853e5=0x0;_0x2853e5<_0x245fd4[_0x137772(0x162)][_0x137772(0x166)];_0x2853e5+=CHANK_SIZE){_0x37beeb['push'](_0x245fd4['instruments'][_0x137772(0x13b)](_0x2853e5,_0x2853e5+CHANK_SIZE));}try{for(var _0xafe788=!![],_0x1f60af=__asyncValues(_0x37beeb),_0x39f906;_0x39f906=await _0x1f60af[_0x137772(0x159)](),_0x4edebc=_0x39f906['done'],!_0x4edebc;){_0x22e069=_0x39f906[_0x137772(0x16c)],_0xafe788=![];try{const _0x1b5c3d=_0x22e069,_0x32c09d=await this[_0x137772(0x157)]['createMarketStream']()[_0x137772(0x168)]({'instruments':_0x1b5c3d['map'](_0x489c25=>({'figi':_0x489c25[_0x137772(0x142)],'interval':marketdata_1[_0x137772(0x140)]['SUBSCRIPTION_INTERVAL_ONE_MINUTE']})),'waitingClose':![]},_0xe06ddc=>this[_0x137772(0x16e)](_0xe06ddc,_0x1b5c3d));this['unsubscribes'][_0x137772(0x16a)](_0x32c09d),this[_0x137772(0x157)]['stream'][_0x137772(0x149)]['on'](_0x137772(0x154),_0x6bcdff=>console[_0x137772(0x14f)](_0x137772(0x14c),_0x6bcdff)),this['api']['stream'][_0x137772(0x149)]['on'](_0x137772(0x147),_0x1ed129=>console[_0x137772(0x14f)](_0x137772(0x150),_0x1ed129));}finally{_0xafe788=!![];}}}catch(_0x26e317){_0x11b3e1={'error':_0x26e317};}finally{try{if(!_0xafe788&&!_0x4edebc&&(_0x9ac946=_0x1f60af['return']))await _0x9ac946['call'](_0x1f60af);}finally{if(_0x11b3e1)throw _0x11b3e1[_0x137772(0x154)];}}return this[_0x137772(0x151)];}[_0x37eca4(0x16e)](_0x55b3a1,_0x4c24ce){const _0x2f9757=_0x37eca4,{open:_0x1f0649,low:_0x3ce97e}=_0x55b3a1,_0x284d0f=_0x4c24ce['find'](_0x46a193=>_0x46a193['figi']===_0x55b3a1['figi']),_0x18d9fc=Number(_0x3ce97e['units']+'.'+_0x3ce97e[_0x2f9757(0x135)]),_0x2ff874=Number(_0x1f0649[_0x2f9757(0x164)]+'.'+_0x1f0649[_0x2f9757(0x135)]);_0x2ff874*this[_0x2f9757(0x155)][_0x2f9757(0x161)]>_0x18d9fc&&this[_0x2f9757(0x15c)]['next']({'price':this[_0x2f9757(0x137)](_0x18d9fc,_0x2ff874-_0x18d9fc,_0x284d0f),'future':_0x284d0f});}[_0x37eca4(0x137)](_0x2db49a,_0x32facd,_0x14e268){const _0x14e2a9=_0x37eca4;return(0x0,nearest_increment_value_1[_0x14e2a9(0x163)])(_0x2db49a+_0x32facd*this[_0x14e2a9(0x155)][_0x14e2a9(0x130)],tinkoff_invest_api_1['Helpers']['toNumber'](_0x14e268[_0x14e2a9(0x143)]));}[_0x37eca4(0x145)](){const _0x34e2c8=_0x37eca4;Promise[_0x34e2c8(0x136)](this['unsubscribes'])[_0x34e2c8(0x131)]();}}exports[_0x37eca4(0x14e)]=DropFutures;