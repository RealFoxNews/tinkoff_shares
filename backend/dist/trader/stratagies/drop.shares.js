'use strict';const _0x24c29b=_0x196c;(function(_0x157da3,_0x3d70d4){const _0x48dfcb=_0x196c,_0x4ec2f2=_0x157da3();while(!![]){try{const _0x16129b=-parseInt(_0x48dfcb(0x17a))/0x1+parseInt(_0x48dfcb(0x149))/0x2+-parseInt(_0x48dfcb(0x183))/0x3+-parseInt(_0x48dfcb(0x152))/0x4*(parseInt(_0x48dfcb(0x189))/0x5)+-parseInt(_0x48dfcb(0x146))/0x6+parseInt(_0x48dfcb(0x140))/0x7*(-parseInt(_0x48dfcb(0x161))/0x8)+parseInt(_0x48dfcb(0x14c))/0x9*(parseInt(_0x48dfcb(0x14a))/0xa);if(_0x16129b===_0x3d70d4)break;else _0x4ec2f2['push'](_0x4ec2f2['shift']());}catch(_0x143a58){_0x4ec2f2['push'](_0x4ec2f2['shift']());}}}(_0x5142,0xc2d15));Object[_0x24c29b(0x159)](exports,_0x24c29b(0x17d),{'value':!![]}),exports[_0x24c29b(0x17c)]=void 0x0;const moment=require(_0x24c29b(0x16a)),rxjs_1=require(_0x24c29b(0x19f)),tinkoff_invest_api_1=require(_0x24c29b(0x190)),instruments_1=require(_0x24c29b(0x197)),marketdata_1=require(_0x24c29b(0x142)),nearest_increment_value_1=require(_0x24c29b(0x18c)),drop_exclude_share_1=require(_0x24c29b(0x185)),stratagies_names_1=require(_0x24c29b(0x188)),CHANK_SIZE=0x12c;function _0x5142(){const _0x4d58a0=['excludeByHalts','minPriceIncrement','stream','then','wallet','api','price','30609Znkytz','unsubscribes','DropShares','__esModule','stoped','share','allowTo','stream\x20error','Чанк\x20','1733790fDGpNI','excludeByExchange','./drop.exclude-share','halt','except','./stratagies.names','7130405DxrApi','filter','MOEX','../utils/nearest-increment-value','toNumber','slice','log','tinkoff-invest-api','nearestHighIncrementValue','day','diffShares','shareReports','subscribe','STRATAGIES_NAMES','tinkoff-invest-api/cjs/generated/instruments','processOnCandle','forEach','hours','ticker','reloadOptions','INSTRUMENT_STATUS_BASE','futures','rxjs','Helpers','next','DROP','\x1b[36m%s\x1b[0m','minutes','maxMoneySize','diffSharesBuy','Subject','SUBSCRIPTION_INTERVAL_ONE_MINUTE','5801460lTTmcz','figi','tinkoff-invest-api/cjs/generated/marketdata','shareDividends','\x20запущен','options','2522508Inuayu','foreignDiffSharesBuy','includeReports','1078108ujfzUv','3220670ccwlmR','moexDiffSharesBuy','99CcXmTg','push','createMarketStream','sharesSettings','pipe','includes','4OIoYbE','length','isSameOrBefore','excludeByHealth','getPrice','endOf','Параметры\x20Слеза:\x20обновлены','defineProperty','has','buyTheDrop','setUnavaliableShares','from','isSameOrAfter','tap','combineLatest','8nOjzPm','error','unavaliableShares','\x1b[37m','instruments','exchange','market','stream\x20closed,\x20reason:','InstrumentStatus','moment','start','all','startOf','shareFDA','excludeByList','add','shareHalts','buy'];_0x5142=function(){return _0x4d58a0;};return _0x5142();}function _0x196c(_0x2d9db0,_0x400f3c){const _0x5142cd=_0x5142();return _0x196c=function(_0x196cb5,_0x5e8611){_0x196cb5=_0x196cb5-0x137;let _0x203d2f=_0x5142cd[_0x196cb5];return _0x203d2f;},_0x196c(_0x2d9db0,_0x400f3c);}class DropShares{constructor(_0x4ba105,_0x2b4e75,_0x2a7712){const _0x241d17=_0x24c29b;this[_0x241d17(0x178)]=_0x4ba105,this['wallet']=_0x2a7712,this['stoped']=![],this[_0x241d17(0x186)]=![],this['unsubscribes']=[],this[_0x241d17(0x15b)]=new rxjs_1[(_0x241d17(0x13e))](),this[_0x241d17(0x163)]=new Set(),this[_0x241d17(0x145)]=_0x2b4e75,this[_0x241d17(0x15b)][_0x241d17(0x150)]((0x0,rxjs_1[_0x241d17(0x18a)])(()=>!this[_0x241d17(0x186)]),(0x0,rxjs_1[_0x241d17(0x15f)])(()=>{const _0x114441=_0x241d17;!this[_0x114441(0x186)]&&(this[_0x114441(0x186)]=!![],setTimeout(()=>this[_0x114441(0x186)]=![],this['options']['haltTimeout']));}),(0x0,rxjs_1[_0x241d17(0x15f)])(_0x84ef2b=>{const _0x237ada=_0x241d17;this[_0x237ada(0x177)][_0x237ada(0x172)](_0x84ef2b[_0x237ada(0x179)],_0x84ef2b[_0x237ada(0x17f)],stratagies_names_1[_0x237ada(0x196)][_0x237ada(0x139)]);}))[_0x241d17(0x195)]();}async[_0x24c29b(0x16b)](_0x4267e3,_0x4a6ea5,_0x433bd8,_0x304628){const _0xda4af8=_0x24c29b;this[_0xda4af8(0x17e)]=![];const _0x282052=await this[_0xda4af8(0x178)][_0xda4af8(0x165)][_0xda4af8(0x19e)]({'instrumentStatus':instruments_1[_0xda4af8(0x169)]['INSTRUMENT_STATUS_BASE']});(0x0,rxjs_1[_0xda4af8(0x160)])([_0x4267e3,_0x4a6ea5,_0x433bd8,_0x304628])[_0xda4af8(0x195)](_0xda1582=>{const _0x8c3969=_0xda4af8;this[_0x8c3969(0x143)]=_0xda1582[0x0],this[_0x8c3969(0x16e)]=_0xda1582[0x1],this[_0x8c3969(0x171)]=_0xda1582[0x2],this[_0x8c3969(0x194)]=_0xda1582[0x3],this[_0x8c3969(0x15c)](_0x282052[_0x8c3969(0x165)]);});const _0xaf498b=_0x282052[_0xda4af8(0x165)][_0xda4af8(0x18a)](_0x14c0fa=>_0x14c0fa[_0xda4af8(0x166)]['includes']('MOEX')),_0x31fba1=[];for(let _0x1a884b=0x0;_0x1a884b<_0xaf498b[_0xda4af8(0x153)];_0x1a884b+=CHANK_SIZE){_0x31fba1[_0xda4af8(0x14d)](_0xaf498b[_0xda4af8(0x18e)](_0x1a884b,_0x1a884b+CHANK_SIZE));}_0x31fba1[_0xda4af8(0x199)]((_0x4e1841,_0x5181ea)=>{const _0x4fe30e=_0xda4af8,_0x2b5644=this[_0x4fe30e(0x178)][_0x4fe30e(0x14e)]()['candles']({'instruments':_0x4e1841['map'](_0x16c403=>({'figi':_0x16c403[_0x4fe30e(0x141)],'interval':marketdata_1['SubscriptionInterval'][_0x4fe30e(0x13f)]})),'waitingClose':![]},_0x43b47d=>this[_0x4fe30e(0x198)](_0x43b47d,_0x4e1841));setTimeout(()=>{const _0x471b6e=_0x4fe30e;(0x0,rxjs_1[_0x471b6e(0x15d)])(_0x2b5644)[_0x471b6e(0x195)](_0x1fa4b8=>{const _0x3e8683=_0x471b6e;!this['stoped']?(console[_0x3e8683(0x18f)](_0x3e8683(0x182)+_0x31fba1['length']+_0x3e8683(0x144)),this[_0x3e8683(0x17b)][_0x3e8683(0x14d)](_0x1fa4b8)):_0x1fa4b8();});},_0x5181ea*0x3e8);}),this[_0xda4af8(0x178)][_0xda4af8(0x175)][_0xda4af8(0x167)]['on'](_0xda4af8(0x162),_0x43d3d6=>console['log'](_0xda4af8(0x181),_0x43d3d6)),this[_0xda4af8(0x178)][_0xda4af8(0x175)][_0xda4af8(0x167)]['on']('close',_0xfa8426=>console[_0xda4af8(0x18f)](_0xda4af8(0x168),_0xfa8426));}['stop'](){const _0x447452=_0x24c29b;Promise[_0x447452(0x16c)](this[_0x447452(0x17b)])[_0x447452(0x176)](),this[_0x447452(0x17e)]=!![];}[_0x24c29b(0x15c)](_0x181725){const _0x59d894=_0x24c29b;this['unavaliableShares']=new Set(),_0x181725[_0x59d894(0x199)](_0x15b437=>{const _0x176f5c=_0x59d894;(0x0,drop_exclude_share_1[_0x176f5c(0x16f)])(_0x15b437,this[_0x176f5c(0x145)][_0x176f5c(0x187)])&&this['unavaliableShares']['add'](_0x15b437[_0x176f5c(0x19b)]);if((0x0,drop_exclude_share_1[_0x176f5c(0x184)])(_0x15b437,this['options']))this[_0x176f5c(0x163)][_0x176f5c(0x170)](_0x15b437['ticker']);if(!_0x15b437[_0x176f5c(0x166)][_0x176f5c(0x151)](_0x176f5c(0x18b))){if((0x0,drop_exclude_share_1[_0x176f5c(0x155)])(_0x15b437,this[_0x176f5c(0x145)]))this['unavaliableShares'][_0x176f5c(0x170)](_0x15b437[_0x176f5c(0x19b)]);if((0x0,drop_exclude_share_1['excludeByFDA'])(_0x15b437,this[_0x176f5c(0x16e)]))this[_0x176f5c(0x163)]['add'](_0x15b437[_0x176f5c(0x19b)]);if(!this[_0x176f5c(0x145)][_0x176f5c(0x148)]&&(0x0,drop_exclude_share_1['excludeByReports'])(_0x15b437,this[_0x176f5c(0x194)]))this['unavaliableShares'][_0x176f5c(0x170)](_0x15b437[_0x176f5c(0x19b)]);if((0x0,drop_exclude_share_1[_0x176f5c(0x173)])(_0x15b437,this[_0x176f5c(0x171)]))this[_0x176f5c(0x163)][_0x176f5c(0x170)](_0x15b437[_0x176f5c(0x19b)]);if((0x0,drop_exclude_share_1['excludeByDividends'])(_0x15b437,this['shareDividends']))this['unavaliableShares'][_0x176f5c(0x170)](_0x15b437[_0x176f5c(0x19b)]);const _0x252808=moment(),_0x4599d9=moment()[_0x176f5c(0x16d)](_0x176f5c(0x192))['add'](0x11,_0x176f5c(0x19a))[_0x176f5c(0x170)](0x19,_0x176f5c(0x13b)),_0x10b6fd=moment()[_0x176f5c(0x157)](_0x176f5c(0x192));_0x252808['isSameOrAfter'](_0x4599d9)&&_0x252808[_0x176f5c(0x154)](_0x10b6fd)&&!this[_0x176f5c(0x145)]['includeMS']&&this[_0x176f5c(0x163)][_0x176f5c(0x170)](_0x15b437['ticker']),_0x252808[_0x176f5c(0x154)](_0x4599d9)&&_0x252808[_0x176f5c(0x15e)](_0x10b6fd)&&this[_0x176f5c(0x163)][_0x176f5c(0x170)](_0x15b437[_0x176f5c(0x19b)]);}});}['allowTo'](_0x42400d){const _0x4f97f8=_0x24c29b;if(this[_0x4f97f8(0x163)][_0x4f97f8(0x15a)](_0x42400d['ticker']))return![];return!![];}['processOnCandle'](_0x13cff4,_0x279346){const _0x1ace86=_0x24c29b;var _0x191db7;const _0x148c86=_0x279346['find'](_0x2a4ef3=>_0x2a4ef3[_0x1ace86(0x141)]===_0x13cff4[_0x1ace86(0x141)]);if(this[_0x1ace86(0x180)](_0x148c86)){const {open:_0x269b49,low:_0x6cbb55}=_0x13cff4,_0x4873bf=tinkoff_invest_api_1[_0x1ace86(0x137)]['toNumber'](_0x6cbb55),_0x30ca8f=tinkoff_invest_api_1[_0x1ace86(0x137)][_0x1ace86(0x18d)](_0x269b49),_0x379470=Array['isArray']((_0x191db7=this[_0x1ace86(0x145)])===null||_0x191db7===void 0x0?void 0x0:_0x191db7[_0x1ace86(0x14f)])&&this[_0x1ace86(0x145)][_0x1ace86(0x14f)]['find'](_0x5efb57=>_0x5efb57['figi']===_0x148c86[_0x1ace86(0x141)]);_0x148c86[_0x1ace86(0x166)][_0x1ace86(0x151)]('MOEX')?_0x30ca8f*((_0x379470===null||_0x379470===void 0x0?void 0x0:_0x379470[_0x1ace86(0x193)])||this['options']['moexDiffShares'])>=_0x4873bf&&this[_0x1ace86(0x15b)][_0x1ace86(0x138)]({'price':this[_0x1ace86(0x156)](_0x4873bf,_0x30ca8f-_0x4873bf,_0x148c86,_0x379470),'share':_0x148c86,'money':_0x379470===null||_0x379470===void 0x0?void 0x0:_0x379470[_0x1ace86(0x13c)]}):_0x30ca8f*((_0x379470===null||_0x379470===void 0x0?void 0x0:_0x379470[_0x1ace86(0x193)])||this[_0x1ace86(0x145)]['foreignDiffShares'])>=_0x4873bf&&_0x4873bf>0x5&&this[_0x1ace86(0x15b)][_0x1ace86(0x138)]({'price':this['getPrice'](_0x4873bf,_0x30ca8f-_0x4873bf,_0x148c86,_0x379470),'share':_0x148c86,'money':_0x379470===null||_0x379470===void 0x0?void 0x0:_0x379470[_0x1ace86(0x13c)]});}}[_0x24c29b(0x156)](_0x530a4d,_0x25dbed,_0x46020c,_0x3277ed){const _0x5b8ebc=_0x24c29b,_0x2370d0=tinkoff_invest_api_1[_0x5b8ebc(0x137)]['toNumber'](_0x46020c[_0x5b8ebc(0x174)]);if(_0x46020c['exchange'][_0x5b8ebc(0x151)]('MOEX'))return(0x0,nearest_increment_value_1['nearestHighIncrementValue'])(_0x530a4d+_0x25dbed*((_0x3277ed===null||_0x3277ed===void 0x0?void 0x0:_0x3277ed[_0x5b8ebc(0x13d)])||this[_0x5b8ebc(0x145)][_0x5b8ebc(0x14b)]),_0x2370d0);return _0x530a4d<0x5?(0x0,nearest_increment_value_1[_0x5b8ebc(0x191)])(_0x530a4d+_0x2370d0,_0x2370d0):(0x0,nearest_increment_value_1[_0x5b8ebc(0x191)])(_0x530a4d+_0x25dbed*((_0x3277ed===null||_0x3277ed===void 0x0?void 0x0:_0x3277ed['diffSharesBuy'])||this[_0x5b8ebc(0x145)][_0x5b8ebc(0x147)]),_0x2370d0);}[_0x24c29b(0x19c)](_0x3b2cee){const _0x372238=_0x24c29b;this[_0x372238(0x145)]=_0x3b2cee,this[_0x372238(0x178)][_0x372238(0x165)][_0x372238(0x19e)]({'instrumentStatus':instruments_1[_0x372238(0x169)][_0x372238(0x19d)]})['then'](_0x786072=>{const _0x552776=_0x372238;console[_0x552776(0x18f)](_0x552776(0x13a),_0x552776(0x158),_0x552776(0x164)),this[_0x552776(0x15c)](_0x786072[_0x552776(0x165)]);});}}exports[_0x24c29b(0x17c)]=DropShares;